# =============================================================================
# Horizontal Pod Autoscaler (HPA)
# =============================================================================
# PREREQUISITE: metrics-server must be installed
#   minikube addons enable metrics-server
# =============================================================================

apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: {{APP_NAME}}-hpa
  namespace: {{K8S_NAMESPACE}}
  labels:
    app: {{APP_NAME}}
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: {{APP_NAME}}

  # Replica limits
  minReplicas: 2                        # CUSTOMIZE: Minimum pods
  maxReplicas: 5                        # CUSTOMIZE: Maximum pods

  # Scaling metrics
  metrics:
    # CPU-based scaling
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70        # Scale up when CPU > 70%

    # Memory-based scaling (optional)
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 80        # Scale up when memory > 80%

  # Scaling behavior (optional - fine-tune scaling speed)
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300   # Wait 5 min before scaling down
      policies:
        - type: Percent
          value: 50                     # Scale down max 50% at a time
          periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0     # Scale up immediately
      policies:
        - type: Percent
          value: 100                    # Can double pods
          periodSeconds: 60
        - type: Pods
          value: 4                      # Or add max 4 pods
          periodSeconds: 60
      selectPolicy: Max                 # Use whichever adds more pods

---
# =============================================================================
# Simple HPA (CPU only) - Alternative minimal version
# =============================================================================
# apiVersion: autoscaling/v2
# kind: HorizontalPodAutoscaler
# metadata:
#   name: {{APP_NAME}}-hpa
#   namespace: {{K8S_NAMESPACE}}
# spec:
#   scaleTargetRef:
#     apiVersion: apps/v1
#     kind: Deployment
#     name: {{APP_NAME}}
#   minReplicas: 2
#   maxReplicas: 10
#   metrics:
#     - type: Resource
#       resource:
#         name: cpu
#         target:
#           type: Utilization
#           averageUtilization: 70

# DevOps Interview Toolkit - Workflows

## IMPORTANT: Directory Structure

```
~/                                  ← Home directory
│
├── lab-toolkit/                    ← YOUR TOOLKIT (never deployed)
│   ├── 1-infra-setup.sh
│   ├── 2-generate-project.sh
│   ├── helpers/
│   ├── templates/
│   └── buged-php/                  ← Practice bugs only
│
└── their-php-app/                  ← THEIR APP (gets deployed)
    ├── index.php                   ← Their buggy code - YOU FIX
    ├── config.php
    ├── Dockerfile                  ← Generated by toolkit
    ├── Jenkinsfile                 ← Generated by toolkit
    └── k8s/                        ← Generated by toolkit

NOTICE: Both folders are SIBLINGS at ~/
        The app is NOT inside the toolkit!
```

---

## Interview Flow - Step by Step

### Step 1: Copy/Download Toolkit
```bash
# Get the toolkit onto their laptop (USB, git clone, or download)
cd ~
# Toolkit is now at: ~/lab-toolkit/
```

### Step 2: Run Infrastructure Setup
```bash
# Go INTO the toolkit folder
cd ~/lab-toolkit

# Run setup FROM HERE
./1-infra-setup.sh

# This installs: Docker, minikube, kubectl, Jenkins, PHP
# Takes ~15 minutes - listen to requirements while it runs
```

### Step 3: Clone Their Buggy App
```bash
# IMPORTANT: Go back to home directory first!
cd ~

# Clone their repo - this creates a SIBLING folder to lab-toolkit
git clone http://gitlab.company.local/team/buggy-php-app.git

# Now you have:
# ~/lab-toolkit/        ← toolkit
# ~/buggy-php-app/      ← their app (SIBLING, not inside toolkit!)

# Enter their app folder
cd buggy-php-app
pwd
# Shows: ~/buggy-php-app
```

### Step 4: Fix the PHP Bugs
```bash
# You should be in: ~/buggy-php-app/

# Run syntax check
php -l *.php

# Or use the helper (note the full path back to toolkit)
~/lab-toolkit/helpers/php-debug.sh

# Fix bugs in your editor
# Re-run syntax check until all pass
```

### Step 5: Generate Deployment Files
```bash
# STAY in the app repo directory!
pwd
# Must show: ~/buggy-php-app (NOT ~/lab-toolkit!)

# Run the generator using FULL PATH to toolkit
~/lab-toolkit/2-generate-project.sh

# Answer the prompts:
# - GitLab URL: http://gitlab.company.local/team/buggy-php-app.git
# - PHP version: 8.1
# - App name: buggy-php-app
# - etc.

# Files are generated IN YOUR CURRENT DIRECTORY (the app folder):
ls -la
# Dockerfile      ← NEW (generated)
# Jenkinsfile     ← NEW (generated)
# k8s/            ← NEW (generated)
# index.php       ← Their original code (fixed by you)
```

### Step 6: Push to GitLab
```bash
# Still in ~/buggy-php-app/
git add .
git commit -m "Add CI/CD pipeline and fix PHP bugs"
git push origin main
```

### Step 7: Jenkins Builds & Deploys
```bash
# Open Jenkins in browser
# http://localhost:8080 (admin/admin)
# Click "Build Now" on the pipeline job
# OR wait for auto-trigger
```

### Step 8: Show Working App
```bash
# Get the public URL
minikube service buggy-php-app --url

# Open in browser or curl
curl $(minikube service buggy-php-app --url)
```

---

## Visual Command Flow

```
STEP   COMMAND                                    RESULT (pwd)
────   ───────                                    ────────────
1      cd ~                                       ~/
2      cd ~/lab-toolkit && ./1-infra-setup.sh    ~/lab-toolkit/
3      cd ~ && git clone <url>                   ~/
4      cd ~/buggy-php-app                        ~/buggy-php-app/
5      ~/lab-toolkit/2-generate-project.sh       ~/buggy-php-app/  ← files generated HERE
6      git add . && git commit && git push       ~/buggy-php-app/
7      (browser) localhost:8080                  -
8      minikube service <app> --url              -
```

---

## Common Mistakes to Avoid

| Mistake | Why It's Wrong | Correct Way |
|---------|----------------|-------------|
| Cloning app INSIDE toolkit folder | Mixes your tools with their code | `cd ~` first, then `git clone` |
| Running `2-generate-project.sh` from toolkit | Files generated in wrong place | `cd` to app folder first |
| Forgetting `cd ~` before cloning | App ends up inside toolkit | Always go to `~` before clone |
| Pushing toolkit files to their GitLab | Wrong repo! | Only push from app folder |

---

## Quick Reference

```bash
# Where am I?
pwd

# Go to toolkit
cd ~/lab-toolkit

# Go to their app
cd ~/buggy-php-app

# Run infra setup (FROM toolkit folder)
cd ~/lab-toolkit && ./1-infra-setup.sh

# Generate files (FROM app folder, using full path to script)
cd ~/buggy-php-app && ~/lab-toolkit/2-generate-project.sh

# Check pods
kubectl get pods

# Get app URL
minikube service <app-name> --url
```

---

## Testing/Practice Flow

```bash
# 1. Setup (one time)
cd ~/lab-toolkit
./1-infra-setup.sh

# 2. Create practice folder (INSIDE buged-php for practice)
cd ~/lab-toolkit/buged-php
./copy-for-practice.sh my-practice
cd my-practice

# 3. Fix bugs
php -l *.php
# fix bugs...

# 4. Generate deployment files (use full path)
~/lab-toolkit/2-generate-project.sh
# Use fake GitLab URL: http://test.local/test/app

# 5. Test deployment
kubectl apply -f k8s/
minikube service <app-name> --url

# 6. Cleanup
kubectl delete -f k8s/
cd ~/lab-toolkit
rm -rf buged-php/my-practice
```

---

## Emergency Procedures

**Pod won't start (ImagePullBackOff):**
```bash
eval $(minikube docker-env)
docker build -t <app-name>:latest .
kubectl delete pod -l app=<app-name>
```

**Jenkins can't connect to K8s:**
```bash
docker exec jenkins kubectl get nodes
# If fails:
docker cp ~/.kube/config jenkins:/var/jenkins_home/.kube/config
docker restart jenkins
```

**Full reset:**
```bash
cd ~/lab-toolkit
./cleanup.sh
./1-infra-setup.sh
```

---

## Time Management (3-hour interview)

| Phase | Time | What | Where |
|-------|------|------|-------|
| Setup | 0:00-0:15 | Run 1-infra-setup.sh | ~/lab-toolkit/ |
| Clone | 0:15-0:20 | Clone their repo | cd ~ then clone |
| Debug | 0:20-0:35 | Fix PHP bugs | ~/their-app/ |
| Deploy | 0:35-0:50 | Generate files, push | ~/their-app/ |
| Jenkins | 0:50-1:10 | Build pipeline | browser |
| Demo | 1:10-1:30 | Show working app | browser |
| Buffer | 1:30-3:00 | Q&A, troubleshooting | - |
